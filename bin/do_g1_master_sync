#!/bin/sh
pushd `cat ~/.markutils/m1`
CUR_BRANCH=`git branch | grep ^\* | cut -c 3-`
echo CUR_BRANCH=$CUR_BRANCH

echo fetch
git fetch

echo co trunk
git checkout trunk

echo rebase origin/trunk
git rebase origin/trunk

# WebKit
pushd third_party/WebKit
echo fetch webkit
git fetch origin

CUR_WKBRANCH=`git branch | grep ^\* | cut -c 3-`
echo CUR_WKBRANCH=$CUR_WKBRANCH

echo co master
git checkout master

echo rebase origin/master
git rebase origin/master

echo co $CUR_WKBRANCH
git checkout $CUR_WKBRANCH

popd

echo sync webkit git
./tools/sync-webkit-git.py

#gclient
echo gclient sync
if test "x$OSTYPE" != "xcygwin"; then
gclient sync -j16
else
gclient sync
fi

# all done :)
echo co $CUR_BRANCH
git checkout $CUR_BRANCH
echo You still need to rebase your active branch
popd
